# task4_2

**Задание 4.2 - Управление конфигурацией “для бедных”**

Условие задания:

	Создайте bash скрипт ntp_deploy.sh, который:
    		• устанавливает пакет с ntp сервером
    		• Удаляет из конфигурационного файла ntp-сервера, настроенные по умолчанию (например 0.ubuntu.pool.ntp.org )
    		• прописывает в качестве ntp-сервера ua.pool.ntp.org  
    		• перезапускает ntp сервис
    		• Прописывает в крон запуск скрипта ntp_verify.sh раз в 1 минуту.
	Создайте bash скрипт ntp_verify.sh, который:
    		• Проверяет запущен ли ntp процесс. Если процесс не запущен, запускает его
    		• Проверяет факт изменения конфигурационного файла ntp.conf. В случае наличия изменений, выводит их в stdout. 	Возвращает конфигурационный файл в правильное состояние и перезапускает сервис NTP. Иначе говоря, конфигурационный файл должен поддерживаться в том состоянии, каким его создал ntp_deploy.sh (т.е. с ntp-сервером ua.pool.ntp.org, а не с настройками по-умолчанию).
    
Дополнительные требования:

    1. Баш скрипты  с выполненными заданиями должны быть загружены в гитхаб репозитарий c названием ‘task4_2’
    2. В гитхаб репозитарии ‘task4_2’ должно содержаться 2 скрипта  ntp_deploy.sh и ntp_verify.sh.
    3. Во время проверки задания скрипт ntp_verify.sh может запускаться многократно.

Проверка результатов:

    • Для каждого запуска будет использоваться отдельная ВМ (ОС ubuntu xenial 16.04 server, образ). Исходя из особенностей проверки и работы СRON на виртуальную машину будет предварительно установлен пакет sendmail. Скрипты будут запускаться из-под суперпользователя (root). ВМ имеет доступ в интернет.
    • В ВМ будет склонирован репозиторий с заданием ( например https://github.com/user/task4_2, если репозиторий будет иметь другое имя, то задание будет автоматически помечено как невыполненное.
    • Автоматически будет запущен скрипт  ‘ntp_deploy.sh’ из корневой папки репозитория (если скрипт будет называться иначе или будет находиться в подпапке - он запущен не будет, соответственно, задание будет автоматически помечено как невыполненное)
    • В процессе проверки скрипт ntp_verify.sh может быть запущен из консоли (не дожидаясь срабатывания планировщика) и ожидается его корректное поведение.
    • После запуска ntp_deploy.sh будет проверено состояние конфигурационного файла ntp.conf. Ожидается, что он будет отличаться от конфигурационного файла по-умолчанию только конфигурацией NTP серверов и единственным настроенным NTP сервером будет ua.pool.ntp.org
    • Некоторое время, пока будет существовать ВМ, в конфигурационный файл ntp.conf могут вноситься самые разнообразные изменения. Ожидается, что:
        ◦ Если изменений не обнаружено, скрипт не выводит никуда никаких сообщений и не перезапускает ntp сервис.
        ◦ Если файл был изменен, то скрипт:
            ▪ Выводит разницу в stdout
            ▪ Восстанавливает состояние файла ntp.conf (т.е. Дефолт + единственный сервер  ua.pool.ntp.org)
            ▪ Перезапускает демон ntp
    • Проверка того, что скрипт вывел разницу между конфигурационными файлами в stdout при отработке планировщика (крон) будет чтение файла /var/mail/root
    • Перед выводом разницы между эталонным и измененным файлом ntp.conf должна присутствовать строка “NOTICE: /etc/ntp.conf was changed. Calculated diff:”. Пример ожидаемого сообщения:

	NOTICE: /etc/ntp.conf was changed. Calculated diff:
		--- /etc/ntp.conf.bak   2018-03-27 16:45:40.693954805 +0000
		+++ /etc/ntp.conf       2018-03-27 16:56:55.723992297 +0000
		@@ -20 +20 @@
		-pool ua.pool.ntp.org
		+pool us.pool.ntp.org
    • Изменения в конфигурационном файле должны выводиться в “unified format”
    • В процессе существования ВМ после запуска скрипта ntp_deploy.sh демон ntp может быть остановлен. Ожидается, что после срабатывания скрипта ntp_verify.sh (либо через крон, либо при запуске вручную) скрипт выведет в stdout сообщение “NOTICE: ntp is not running” и запустит сервис ntp.
